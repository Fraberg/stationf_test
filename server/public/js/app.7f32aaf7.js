(function(e){function t(t){for(var a,o,i=t[0],u=t[1],s=t[2],d=0,p=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&p.push(r[o][0]),r[o]=0;for(a in u)Object.prototype.hasOwnProperty.call(u,a)&&(e[a]=u[a]);l&&l(t);while(p.length)p.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],a=!0,i=1;i<n.length;i++){var u=n[i];0!==r[u]&&(a=!1)}a&&(c.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},c=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var l=u;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"345c":function(e,t,n){"use strict";n("a70d")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("7a23");function r(e,t,n,r,c,o){var i=Object(a["t"])("RoomsComponent");return Object(a["m"])(),Object(a["e"])("div",null,[Object(a["i"])(i)])}var c=Object(a["D"])("data-v-2d27d174");Object(a["o"])("data-v-2d27d174");var o={class:"container"},i={class:"form-container"},u={class:"mb-4"},s={class:"datepicker-subtemplate flex flex-col sm:flex-row justify-start items-center"},l={class:"date-picker-input-wrapper relative flex-grow"},d=Object(a["i"])("p",{class:"label-input"},"Début",-1),p=Object(a["i"])("span",{class:"flex-shrink-0 m-2"},null,-1),b={class:"date-picker-input-wrapper relative flex-grow"},v=Object(a["i"])("p",{class:"label-input"},"Fin",-1),f={class:"capacity"},m=Object(a["i"])("p",{class:"label-capacity"},"Capacité",-1),O={class:"equipments"},j=Object(a["i"])("p",{class:"label-equipments"},"Équipements",-1),g={class:"label-display-if-booked"},h=Object(a["i"])("p",{class:"display-if-booked"},"Afficher les salles réservées",-1),y={class:"filters-synthesis"},k=Object(a["i"])("hr",null,null,-1),w={class:"delete-reservations"};Object(a["n"])();var R=c((function(e,t,n,r,R,x){var D=Object(a["t"])("v-date-picker"),q=Object(a["t"])("RoomsListComponent");return Object(a["m"])(),Object(a["e"])("div",o,[Object(a["i"])("div",i,[Object(a["i"])("form",{class:"bg-white shadow-md rounded px-8 pt-6 pb-8",onSubmit:t[5]||(t[5]=Object(a["C"])((function(){}),["prevent"]))},[Object(a["i"])("div",u,[Object(a["i"])(D,{modelValue:r.range,"onUpdate:modelValue":t[1]||(t[1]=function(e){return r.range=e}),mode:"dateTime",masks:r.masks,"is-range":"","min-date":(new Date).setHours(0,0,0,0),"minute-increment":5},{default:c((function(e){var t=e.inputValue,n=e.inputEvents,r=e.isDragging;return[Object(a["i"])("div",s,[Object(a["i"])("div",l,[d,Object(a["i"])("input",Object(a["k"])({class:["flex-grow pl-8 pr-2 py-1 bg-gray-100 border rounded w-full",r?"text-gray-600":"text-gray-900"],value:t.start},Object(a["v"])(n.start)),null,16,["value"])]),p,Object(a["i"])("div",b,[v,Object(a["i"])("input",Object(a["k"])({class:["flex-grow pl-8 pr-2 py-1 bg-gray-100 border rounded w-full",r?"text-gray-600":"text-gray-900"],value:t.end},Object(a["v"])(n.end)),null,16,["value"])])])]})),_:1},8,["modelValue","masks","min-date"]),Object(a["i"])("div",f,[m,Object(a["B"])(Object(a["i"])("input",{"onUpdate:modelValue":t[2]||(t[2]=function(e){return r.selectedCapacity=e}),type:"number",step:"1",min:"1",required:"true"},null,512),[[a["x"],r.selectedCapacity]])]),Object(a["i"])("div",O,[j,Object(a["B"])(Object(a["i"])("input",{"onUpdate:modelValue":t[3]||(t[3]=function(e){return r.selectedEquipments=e}),placeholder:"TV, Retro ..."},null,512),[[a["x"],r.selectedEquipments]])]),Object(a["i"])("div",g,[h,Object(a["B"])(Object(a["i"])("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=function(e){return r.displayBookedRooms=e})},null,512),[[a["w"],r.displayBookedRooms]])])])],32)]),Object(a["i"])("p",y,Object(a["u"])(r.getSynthesis),1),k,Object(a["i"])(q,{rooms:r.filteredRooms,onCreateReservation:r.createReservation,getRangeSpan:r.getRangeSpan,isLoading:r.isLoading,error:r.error},null,8,["rooms","onCreateReservation","getRangeSpan","isLoading","error"]),Object(a["i"])("div",w,[Object(a["B"])(Object(a["i"])("button",{onClick:t[6]||(t[6]=function(){return r.deleteReservations&&r.deleteReservations.apply(r,arguments)})}," Supprimer les réservations ",512),[[a["y"],r.reservations.length]])])])})),x=(n("99af"),n("4de4"),n("4160"),n("caad"),n("d81d"),n("b0c0"),n("ac1f"),n("2532"),n("1276"),n("498a"),n("159b"),n("b85c")),D=(n("96cf"),n("1da1")),q=(n("d3b7"),n("5530")),S=n("d4ec"),C=n("bee2"),L=n("bc3a"),_=n.n(L),M="api/rooms/",E=function(){function e(){Object(S["a"])(this,e)}return Object(C["a"])(e,null,[{key:"getRooms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t,n){_.a.get(M,{params:{capacity:e}}).then((function(e){var n=e.data;t(n.map((function(e){return Object(q["a"])(Object(q["a"])({},e),{},{createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})})))})).catch((function(e){n(e)}))}))}},{key:"insertRoom",value:function(e){return _.a.post(M,{text:e})}},{key:"deleteRoom",value:function(e){return _.a.delete("".concat(M).concat(e))}}]),e}(),A=E,T="api/reservations/",P=function(){function e(){Object(S["a"])(this,e)}return Object(C["a"])(e,null,[{key:"getReservations",value:function(e){return new Promise((function(t,n){_.a.get(T,{params:{range:e}}).then((function(e){var n=e.data;t(n.map((function(e){return Object(q["a"])(Object(q["a"])({},e),{},{start:new Date(e.start),end:new Date(e.end),createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)})})))})).catch((function(e){n(e)}))}))}},{key:"insertReservation",value:function(e,t,n){return _.a.post(T,{user_id:"",room_id:e._id,start:new Date(t.start.getTime()+0),end:new Date(t.end.getTime()+0),participants:n})}},{key:"deleteReservation",value:function(e){return _.a.delete("".concat(T).concat(e))}}]),e}(),V=P,I=(n("a4d3"),n("e01a"),Object(a["D"])("data-v-7eb46d29"));Object(a["o"])("data-v-7eb46d29");var B={class:"rooms-container"},N=Object(a["g"])('<div class="list-headers" data-v-7eb46d29><p class="name" data-v-7eb46d29>Nom</p><p class="capacity" data-v-7eb46d29>Capacité</p><p class="description" data-v-7eb46d29>Description</p><p class="equipments" data-v-7eb46d29>Équipements</p><p class="reservation" data-v-7eb46d29>Réservation</p></div><hr data-v-7eb46d29>',2),J={key:0,class:"loading"},Y=Object(a["i"])("h2",null,"Chargement ... :)",-1),U={key:1,class:"error"},F={class:"name"},z={class:"capacity"},H={class:"description"},G={class:"equipments"},K={class:"reservation"},Q={key:1},W={key:2};Object(a["n"])();var X=I((function(e,t,n,r,c,o){return Object(a["m"])(),Object(a["e"])("div",B,[N,n.isLoading?(Object(a["m"])(),Object(a["e"])("div",J,[Y])):n.error?(Object(a["m"])(),Object(a["e"])("div",U,[Object(a["i"])("p",null,Object(a["u"])(n.error),1)])):(Object(a["m"])(!0),Object(a["e"])(a["a"],{key:2},Object(a["r"])(n.rooms,(function(e,t){return Object(a["m"])(),Object(a["e"])("div",{class:"room",item:e,index:t,key:e._id},[Object(a["i"])("p",F,Object(a["u"])(e.name),1),Object(a["i"])("p",z,Object(a["u"])(e.capacity),1),Object(a["i"])("p",H,Object(a["u"])(e.description),1),Object(a["i"])("ul",G,[(Object(a["m"])(!0),Object(a["e"])(a["a"],null,Object(a["r"])(e.equipments,(function(e,t){return Object(a["m"])(),Object(a["e"])("li",{class:"name",item:e,index:t,key:t},Object(a["u"])(e.name),9,["item","index"])})),128))]),Object(a["i"])("div",K,[e.booked?Object(a["f"])("",!0):(Object(a["m"])(),Object(a["e"])("button",{key:0,onClick:function(e){return r.createReservation(t)}},"Réserver",8,["onClick"])),e.booked?Object(a["f"])("",!0):(Object(a["m"])(),Object(a["e"])("p",Q,"pour "+Object(a["u"])(n.getRangeSpan),1)),e.booked?(Object(a["m"])(),Object(a["e"])("p",W,Object(a["u"])(e.bookedInfo),1)):Object(a["f"])("",!0)])],8,["item","index"])})),128))])})),Z={name:"RoomsListComponent",props:["rooms","getRangeSpan","isLoading","error"],emits:["create-reservation"],setup:function(e,t){function n(e){t.emit("create-reservation",e)}return{createReservation:n}}};n("345c");Z.render=X,Z.__scopeId="data-v-7eb46d29";var $=Z,ee=n("fa7d"),te=n.n(ee),ne=n("3d20"),ae={name:"RoomComponent",components:{RoomsListComponent:$},setup:function(){var e=Object(a["q"])([]),t=Object(a["q"])(2),n=Object(a["q"])(""),r=Object(a["q"])(!1),c=Object(a["q"])(""),o=Object(a["q"])(!0),i=Object(a["q"])([]),u=Object(a["q"])({start:te.a.roundDate(new Date(Date.now()),5),end:te.a.roundDate(new Date(Date.now()+18e5),5)}),s={input:"YYYY-MM-DD h:mm A"};Object(a["l"])(Object(D["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,A.getRooms();case 3:return e.value=t.sent,t.next=6,V.getReservations(u.value);case 6:i.value=t.sent,m(),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](0),c.value=t.t0.message;case 13:return t.prev=13,o.value=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,null,[[0,10,13,16]])}))));var l=Object(a["c"])((function(){return n.value.trim().toLowerCase()})),d=Object(a["c"])((function(){if("unvalid"===p.value){var e="La durée de la réservation doit être >= à 5 minutes";return e}var a="< ".concat(te.a.formatLiteralDate(u.value.start)," - ").concat(te.a.formatLiteralDate(u.value.end)," (").concat(p.value,") | ").concat(t.value," place").concat(t.value>1?"s":"");return a+=""!==l.value?" | équipée de : ".concat(n.value," >"):" >",a})),p=Object(a["c"])((function(){return te.a.getDuration(u.value.start,u.value.end)})),b=Object(a["c"])((function(){return e.value.filter((function(e){return e.capacity>=t.value&&(!e.booked||r.value)&&(!n.value.length||e.includesSelectedEquipments)})).sort((function(e,t){return e.distance-t.distance}))}));function v(e){l.value.length&&(e.includesSelectedEquipments=!1,l.value.split(" ").forEach((function(t){e.equipments.forEach((function(n){n.name.toLowerCase().includes(t)&&(e.includesSelectedEquipments=!0)}))})))}function f(e){i.value.forEach((function(t){if(t.room_id===e._id&&(t.start>=u.value.start&&t.start<u.value.end||t.end>u.value.start&&t.end<=u.value.end))return e.booked=!0,void(e.bookedInfo="Réservée du ".concat(te.a.formatNumericDate(u.value.start)," au ").concat(te.a.formatNumericDate(u.value.end)))}))}function m(){e.value=e.value.map((function(e){var t=Object.assign({},e);return t.booked=!1,t.includesSelectedEquipments=!0,t})),e.value.forEach((function(e){f(e),v(e)}))}function O(e){return j.apply(this,arguments)}function j(){return j=Object(D["a"])(regeneratorRuntime.mark((function n(a){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.value[a],r){n.next=4;break}return ne.fire("Oops...","Erreur lors de l'enregistrement de cette réservation","error"),n.abrupt("return");case 4:return n.prev=4,r.booked=!0,r.bookedInfo="Réservée du ".concat(te.a.formatNumericDate(u.value.start)," au ").concat(te.a.formatNumericDate(u.value.end)),ne.fire({title:"Réservation enregistrée",html:"Du <b>".concat(te.a.formatLiteralDate(u.value.start),"</b><br>au <b>").concat(te.a.formatLiteralDate(u.value.end),"</b><br>Durée de <b>").concat(p.value,"</b><br>Capacité : ").concat(r.capacity," places au total"),icon:"success"}),n.next=10,V.insertReservation(r,u.value,t.value);case 10:return n.next=12,V.getReservations(u.value);case 12:i.value=n.sent,n.next=19;break;case 15:n.prev=15,n.t0=n["catch"](4),ne.fire("Oops...","Erreur lors de l'enregistrement de cette réservation ".concat(n.t0),"error"),c.value=n.t0;case 19:case"end":return n.stop()}}),n,null,[[4,15]])}))),j.apply(this,arguments)}function g(){return h.apply(this,arguments)}function h(){return h=Object(D["a"])(regeneratorRuntime.mark((function e(){var t,n,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:e.prev=0,t=i.value.map((function(e){return e._id})),ne.fire("Réservations supprimées","Pour la période sélectionnée","success"),i.value=[],m(),n=Object(x["a"])(t),e.prev=6,n.s();case 8:if((a=n.n()).done){e.next=14;break}return r=a.value,e.next=12,V.deleteReservation(r);case 12:e.next=8;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](6),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:e.next=28;break;case 24:e.prev=24,e.t1=e["catch"](0),ne.fire("Oops...","Erreur lors de la suppression de cette réservation ".concat(e.t1),"error"),c.value=e.t1;case 28:case"end":return e.stop()}}),e,null,[[0,24],[6,16,19,22]])}))),h.apply(this,arguments)}return Object(a["z"])(u,Object(D["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("unvalid"!==p.value){e.next=4;break}return c.value=d.value,ne.fire("Oops...",d.value,"error"),e.abrupt("return");case 4:return c.value="",e.prev=5,e.next=8,V.getReservations(u.value);case 8:i.value=e.sent,e.next=15;break;case 11:e.prev=11,e.t0=e["catch"](5),ne.fire("Oops...",e.t0,"error"),c.value=e.t0;case 15:m();case 16:case"end":return e.stop()}}),e,null,[[5,11]])}))),{immediate:!1}),Object(a["z"])(l,(function(){l.value.length&&m()}),{immediate:!1}),{rooms:e,selectedCapacity:t,selectedEquipments:n,displayBookedRooms:r,error:c,isLoading:o,reservations:i,range:u,masks:s,getSynthesis:d,getRangeSpan:p,filteredRooms:b,createReservation:O,deleteReservations:g}}};n("a18c");ae.render=R,ae.__scopeId="data-v-2d27d174";var re=ae,ce={name:"App",components:{RoomsComponent:re}};n("7154");ce.render=r;var oe=ce,ie=n("7b37");Object(a["d"])(oe).use(ie["a"],{}).mount("#app")},7154:function(e,t,n){"use strict";n("8052")},8052:function(e,t,n){},a18c:function(e,t,n){"use strict";n("bdf4")},a70d:function(e,t,n){},bdf4:function(e,t,n){},fa7d:function(e,t,n){n("99af"),n("d3b7"),n("25f0"),n("6062"),n("3ca3"),n("ddb0");var a=n("448a");function r(e,t){e=e.toString();while(e.length<t)e="0"+e;return e}function c(e){return"".concat(r(e.getHours(),2),":").concat(r(e.getMinutes(),2))}function o(e){return"".concat(r(e.getDate(),2),"/").concat(e.getMonth(),"/").concat(e.getFullYear()," ").concat(c(e))}function i(e){var t=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],n=["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];return"".concat(t[e.getDay()]," ").concat(r(e.getDate(),2)," ").concat(n[e.getMonth()]," ").concat(e.getFullYear()," ").concat(c(e))}function u(e,t){var n=6e4*t,a=new Date(Math.round(e.getTime()/n)*n);return a}function s(e,t){var n=u(e,t);return n.getTime()>e.getTime()?n:new Date(n.getTime()+6e4*t)}function l(e,t){var n=t-e,a=Math.floor(n/864e5),r=Math.floor(n%864e5/36e5),c=Math.round(n%864e5%36e5/6e4);if(0===a&&0===r&&0===c)return"unvalid";var o="";return a>0&&(o+="".concat(a," jour"),o+=a>=2?"s ":" "),r>0&&(o+="".concat(r," heure"),o+=r>=2?"s ":" "),c>0&&(o+="".concat(c," minute"),o+=c>=2?"s":""),o}function d(e){var t;return(t=String.prototype).concat.apply(t,a(new Set(e)))}function p(e,t,n){return e>=t&&e<=n}e.exports={formatTime:c,formatNumericDate:o,formatLiteralDate:i,roundDate:s,getDuration:l,getUniqueCharactersIn:d,dateIsInRange:p}}});
//# sourceMappingURL=app.7f32aaf7.js.map